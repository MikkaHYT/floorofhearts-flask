{% extends "admin/base.html" %}

{% block title %}View Message | Floor Of Hearts Admin{% endblock %}

{% block extra_css %}
<style>
    /* Ensure modals are hidden by default */
    .modal {
        display: none !important;
    }
    .modal.show {
        display: block !important;
    }
    
    /* Modal backdrop style */
    .modal-backdrop {
        opacity: 0.5 !important;
    }
    
    /* Center the modal vertically */
    .modal-dialog {
        margin: 10vh auto !important;
    }
    
    /* Message view specific styles */
    .message-container {
        max-width: 900px;
        margin: 0 auto;
    }
    
    .message-header {
        border-bottom: 1px solid #e3e6f0;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }
    
    .message-meta {
        display: flex;
        align-items: center;
        color: #858796;
        font-size: 0.875rem;
    }
    
    .message-meta .dot {
        display: inline-block;
        margin: 0 8px;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background-color: #d1d3e2;
    }
    
    .message-details {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }
    
    .detail-item {
        padding: 15px;
        background-color: #f8f9fc;
        border-radius: 5px;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    
    .detail-item h6 {
        margin-top: 0;
        margin-bottom: 8px;
        color: #4e73df;
        font-weight: 600;
    }
    
    .detail-item p {
        margin-bottom: 0;
    }
    
    .message-body {
        background-color: white;
        padding: 25px;
        border-radius: 5px;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        margin-bottom: 25px;
        line-height: 1.6;
    }
    
    .message-content {
        white-space: pre-line;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 25px;
    }
    
    .action-button {
        flex: 1;
        text-align: center;
        padding: 12px;
        border-radius: 5px;
        font-weight: 500;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .action-button i {
        margin-right: 8px;
    }
    
    .action-button.primary {
        background-color: #4e73df;
        color: white;
    }
    
    .action-button.primary:hover {
        background-color: #2e59d9;
    }
    
    .action-button.secondary {
        background-color: #858796;
        color: white;
    }
    
    .action-button.secondary:hover {
        background-color: #717384;
    }
    
    .action-button.danger {
        background-color: #e74a3b;
        color: white;
    }
    
    .action-button.danger:hover {
        background-color: #d52a1a;
    }
    
    .message-subject {
        margin-top: 0;
        margin-bottom: 5px;
        font-size: 1.5rem;
        color: #5a5c69;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-title">
    <h1>Message Details</h1>
    <div class="actions">
        <a href="{{ url_for('admin_messages') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Messages
        </a>
    </div>
</div>

<div class="message-container">
    <div class="card shadow">
        <div class="card-body p-4">
            <!-- Message Header -->
            <div class="message-header">
                <h2 class="message-subject">{{ message.subject }}</h2>
                <div class="message-meta">
                    <span>From: <strong>{{ message.name }}</strong></span>
                    <span class="dot"></span>
                    <span>{{ message.created_at }}</span>
                    <span class="dot"></span>
                    <span>ID: #{{ message.id }}</span>
                </div>
            </div>
            
            <!-- Contact Information -->
            <div class="message-details">
                <div class="detail-item">
                    <h6><i class="fas fa-user me-2"></i> Contact Name</h6>
                    <p>{{ message.name }}</p>
                </div>
                
                <div class="detail-item">
                    <h6><i class="fas fa-envelope me-2"></i> Email Address</h6>
                    <p><a href="mailto:{{ message.email }}">{{ message.email }}</a></p>
                </div>
                
                <div class="detail-item">
                    <h6><i class="fas fa-phone me-2"></i> Phone Number</h6>
                    <p>
                        {% if message.phone %}
                            <a href="tel:{{ message.phone }}">{{ message.phone }}</a>
                        {% else %}
                            <span class="text-muted">Not provided</span>
                        {% endif %}
                    </p>
                </div>
            </div>
            
            <!-- Message Content -->
            <h5 class="mb-3"><i class="fas fa-comment me-2"></i> Message</h5>
            <div class="message-body">
                <div class="message-content">{{ message.message|nl2br }}</div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <a href="{{ url_for('admin_messages') }}" class="action-button secondary text-decoration-none">
                    <i class="fas fa-arrow-left"></i> Back to Messages
                </a>
                
                <a href="mailto:{{ message.email }}?subject=Re: {{ message.subject }}" class="action-button primary text-decoration-none">
                    <i class="fas fa-reply"></i> Reply by Email
                </a>
                
                {% if message.phone %}
                <a href="tel:{{ message.phone }}" class="action-button secondary text-decoration-none">
                    <i class="fas fa-phone"></i> Call {{ message.phone }}
                </a>
                {% endif %}
                
                <button type="button" class="action-button danger border-0 delete-btn" data-message-id="{{ message.id }}">
                    <i class="fas fa-trash"></i> Delete Message
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteMessageModal{{ message.id }}" tabindex="-1" aria-labelledby="deleteMessageModalLabel{{ message.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteMessageModalLabel{{ message.id }}">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i> This action cannot be undone.
                </div>
                <p>Are you sure you want to delete this message from <strong>{{ message.name }}</strong>?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form action="{{ url_for('admin_delete_message', message_id=message.id) }}" method="POST" class="d-inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-danger">Delete Message</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function() {
        // Set up delete button click handler
        $('.delete-btn').on('click', function() {
            const messageId = $(this).data('message-id');
            const modalId = '#deleteMessageModal' + messageId;
            const modal = new bootstrap.Modal(document.querySelector(modalId));
            modal.show();
        });
    });
</script>
{% endblock %}